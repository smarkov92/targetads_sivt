# Методология детекции SIVT (Sophisticated Invalid Traffic)
## Система обнаружения сложного недобросовестного трафика

---

## Введение

**SIVT (Sophisticated Invalid Traffic)** — это система машинного обучения и статистического анализа для обнаружения сложных форм недобросовестного трафика в медийной рекламе. В отличие от простых методов фильтрации (GIVT), SIVT использует продвинутые алгоритмы для выявления утонченных способов мошенничества.

### Основные принципы

1. **Многоуровневый анализ** — система использует несколько независимых алгоритмов
2. **Машинное обучение** — модели обучены на больших объемах размеченных данных
3. **Статистические аномалии** — выявление отклонений от нормального поведения
4. **Поведенческий анализ** — изучение паттернов взаимодействия пользователей

---

## Архитектура системы

### Основные компоненты

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   IP Fraud      │    │    Z-Score       │    │   Device        │
│  Probability    │    │   Anomalies      │    │ Cookie Lifetime │
│   (ML Model)    │    │ (Statistics)     │    │   (Behavior)    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────────┐
                    │   SIVT Algorithm    │
                    │  (Risk Scoring)     │
                    └─────────────────────┘
                                 │
                    ┌─────────────────────┐
                    │  User Whitelist     │
                    │  (Exclusions)       │
                    └─────────────────────┘
```

---

## 1. IP Fraud Probability (Машинное обучение)

### Описание
Модель машинного обучения, которая анализирует **42 метрики** поведения IP-адреса и предсказывает вероятность того, что трафик с этого IP является фродовым.

### Ключевые метрики модели

#### Временные паттерны
- **Ночная активность**: доля трафика с 01:00 до 05:00
- **Распределение по часам**: равномерность активности в течение суток
- **Максимальные пики**: отношение пиковых значений к медианным

#### Устройства и идентификаторы
- **Концентрация устройств**: количество уникальных Device ID на IP
- **Стабильность устройств**: доля стабильных идентификаторов
- **User Agent разнообразие**: количество различных браузеров

#### Объемы и активность
- **Показы в час**: распределение импрессий по времени
- **Концентрация доменов**: коэффициент Джини для распределения по сайтам
- **CTR аномалии**: отклонения в кликабельности

### Математическая модель

```
P(fraud|IP) = f(x₁, x₂, ..., x₄₂)
```

Где:
- `P(fraud|IP)` — вероятность фрода для IP (от 0 до 1)
- `x₁...x₄₂` — нормализованные метрики поведения IP
- `f()` — обученная ML модель (градиентный бустинг)

### Пороги интерпретации
- **> 0.9 (90%)** — критический фрод
- **0.8-0.9** — высокий риск
- **0.5-0.8** — средний риск
- **< 0.5** — низкий риск

---

## 2. Z-Score аномалии (Статистический анализ)

### Описание
Статистический метод обнаружения аномалий на основе Z-score (стандартного отклонения) для выявления необычных паттернов активности.

### Z-Score по IP + Домен

Анализирует, насколько активность IP на конкретном домене отличается от нормы.

#### Формула расчета
```
Z_domain = (X_ip,domain - μ_global) / σ_global
```

Где:
- `X_ip,domain` — количество показов с IP на домене
- `μ_global` — среднее количество показов для всех IP+домен
- `σ_global` — стандартное отклонение

#### Пример
Если нормальная активность IP на домене = 50 показов ± 20:
- IP показал 150 раз → Z-score = (150-50)/20 = **5.0** (сильная аномалия)
- IP показал 70 раз → Z-score = (70-50)/20 = **1.0** (норма)

### Z-Score по IP + Кампания

Аналогично анализирует активность IP в рамках конкретной рекламной кампании.

### Интерпретация Z-Score
- **|Z| > 7** — экстремальная аномалия (99%+ уверенность в проблеме)
- **|Z| 4-7** — значимая аномалия (95-99% уверенность)
- **|Z| 2-4** — умеренная аномалия (85-95% уверенность)
- **|Z| < 2** — норма

---

## 3. Device Cookie Lifetime (Поведенческий анализ)

### Описание
Анализ "возраста" устройства пользователя для выявления подозрительно новых или кратковременных устройств.

### Логика анализа
```
Cookie_Age = Текущая_дата - Первое_появление_устройства
```

### Штрафные коэффициенты
- **0 дней** (новое устройство): +15 баллов к скору
- **1 день**: +12 баллов
- **2-3 дня**: +8 баллов
- **4-7 дней**: +5 баллов
- **> 15 дней**: исключение из анализа (считается надежным)

### Обоснование
Фродовые системы часто используют "одноразовые" устройства или часто меняют идентификаторы.

---

## 4. User Whitelist (Исключения)

### Описание
Система исключений для пользователей, которые доказали свою добросовестность.

### Критерии попадания в Whitelist
1. **Покупки**: пользователь совершал покупки на сайтах клиентов
2. **Многопроектность**: активность на 3+ различных проектах
3. **Match Table**: есть в таблице сопоставлений CRM систем
4. **Длительность**: более 30 дней активности

---

## 5. Основной алгоритм SIVT скоринга

### Каскадная логика принятия решений

#### Этап 1: Исключения (Скор = 0)
```
IF (пользователь в Whitelist) OR (cookie_lifetime > 15 дней)
THEN SIVT_Score = 0, Статус = "NO_FRAUD"
```

#### Этап 2: Критический фрод (Скор 95-100)
```
IF IP_fraud_probability > 0.9
THEN SIVT_Score = 95 + (IP_fraud_probability - 0.9) × 50
Статус = "CRITICAL"
```

#### Этап 3: Высокий риск (Скор 70-95)
```
IF IP_fraud_probability ∈ [0.8, 0.9]
THEN SIVT_Score = 70 + (IP_fraud_probability - 0.8) × 150 + 
                  min(10, |Z_domain| × 2 + |Z_campaign| × 1)
Статус = "HIGH"
```

#### Этап 4: Нормальная логика (Скор 0-70)
```
SIVT_Score = IP_fraud_probability × 75 +
             min(15, |Z_domain| × 2) +
             min(10, |Z_campaign| × 1.5) +
             Cookie_lifetime_penalty
```

### Итоговые уровни риска
- **NO_FRAUD (0)**: Надежные пользователи
- **CRITICAL (95-100)**: Блокировка обязательна
- **HIGH (70-95)**: Требует проверки
- **MEDIUM (40-69)**: Умеренное подозрение
- **LOW (20-39)**: Минимальный риск
- **MINIMAL (10-19)**: Практически чистый трафик

---

## 6. Трехуровневая архитектура

### Уровень 1: Жесткий детектор (99%+ уверенность)
- **Цель**: Выявление очевидного фрода
- **False Positive Rate**: < 1%
- **Применение**: Автоматическая блокировка

**Критерии:**
- IP fraud probability > 95%
- Z-score > 7 + IP probability > 80%
- Новое устройство + IP probability > 85%

### Уровень 2: Средний детектор (85-99% уверенность)
- **Цель**: Статистически значимые аномалии
- **False Positive Rate**: 1-15%
- **Применение**: Ручная проверка

**Критерии:**
- IP fraud probability 70-95%
- Z-score 4-7 + подтверждающие факторы
- Комбинация средних рисков

### Уровень 3: Мягкий детектор (60-85% уверенность)
- **Цель**: Максимальный охват подозрительного трафика
- **False Positive Rate**: 15-40%
- **Применение**: Мониторинг и аналитика

**Критерии:**
- IP fraud probability 40-70%
- Z-score 2-4
- Поведенческие аномалии

---

## Примеры работы системы

### Пример 1: Критический фрод
```
IP: 192.168.1.100
- IP fraud probability: 0.95 (95%)
- Z-score домен: 8.5
- Cookie lifetime: 0 дней
→ SIVT Score: 97, Статус: CRITICAL
→ Причины: "CRITICAL_IP_FRAUD_PROB", "NEW_DEVICE", "EXTREME_DOMAIN_ZSCORE"
```

### Пример 2: Надежный пользователь
```
IP: 10.0.0.50
- IP fraud probability: 0.6 (60%)
- Есть покупки: Да
- Cookie lifetime: 45 дней
→ SIVT Score: 0, Статус: NO_FRAUD
→ Причины: "WHITELISTED_USER"
```

### Пример 3: Умеренный риск
```
IP: 172.16.1.200
- IP fraud probability: 0.7 (70%)
- Z-score домен: 3.2
- Cookie lifetime: 5 дней
→ SIVT Score: 58, Статус: MEDIUM
→ Причины: "MEDIUM_IP_FRAUD_PROB", "DOMAIN_ZSCORE_ANOMALY"
```

---

## Преимущества методологии

### 1. Научная обоснованность
- Использование статистических методов с известными свойствами
- Машинное обучение на больших объемах данных
- Прозрачные математические формулы

### 2. Гибкость применения
- Три уровня строгости для разных целей
- Настраиваемые пороги
- Возможность A/B тестирования

### 3. Защита от ошибок
- Whitelist для исключения добросовестных пользователей
- Каскадная логика снижает false positives
- Объяснимость каждого решения

### 4. Производительность
- Обработка миллионов событий в день
- Оптимизированные алгоритмы
- Автоматизированный ETL процесс

---

## Контроль качества

### Ключевые метрики мониторинга

1. **Распределение скоров**
   - NO_FRAUD: 40-60%
   - CRITICAL: 1-3%
   - HIGH: 5-15%

2. **Покрытие данных**
   - IP fraud probability: >70%
   - Z-score аномалии: >50%
   - Cookie данные: >90%

3. **Эффективность Whitelist**
   - Снижение false positives на 20-30%
   - Покрытие надежных пользователей: >80%

### Алерты и уведомления
- Слишком много CRITICAL событий (>5%)
- Слишком мало подозрительного трафика (<1%)
- Проблемы с качеством данных

---

## Заключение

Методология SIVT представляет собой современный подход к обнаружению сложного недобросовестного трафика, объединяющий:

- **Машинное обучение** для предсказания фродовых IP
- **Статистические методы** для выявления аномалий
- **Поведенческий анализ** для оценки паттернов пользователей
- **Системы исключений** для защиты добросовестных пользователей

Система обеспечивает высокое качество детекции при минимальном количестве ложных срабатываний, что критически важно для медийной аналитики. 
